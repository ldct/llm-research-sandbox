name: Test Mathlib4 + Canonical image

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/ldct/mathlib4-canonical:v4.27.0-rc1
    steps:
      - name: Test Canonical tactic
        run: |
          cd /project
          cat > Test.lean << 'EOF'
          import Mathlib
          import Canonical

          example : Nat := by canonical
          example : Bool := by canonical
          example : Nat Ã— Nat := by canonical
          example : 1 + 1 = 2 := by norm_num
          example (n : Nat) : n + 0 = n := by simp
          EOF
          lake build Test 2>&1
